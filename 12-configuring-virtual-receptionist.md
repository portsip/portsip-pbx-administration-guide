虚拟前台功能使PortSIP PBX能够自动接听电话。当有电话打进PortSIP时，来电者会看到一个选项列表。来电者可以通过使用手机键盘上的数字来选择合适的选项。你可以通过使用这个功能实现一个菜单。虚拟前台也被称为**Auto Attendant**。
  
例如，"**感谢您与我们联系，如果是销售，请按1；如果是支持，请按2或排队等候转接给接线员**"。
  
你可以配置各种虚拟前台，每个人都拥有一个独特的分机号码。根据你的喜好，你可以配置为:根据来电的线路和来源，以及来电是在办公时间内还是在办公时间外接听。例如，你可以在办公时间外有一个不同的提示，不包括转到组/队的选项，因为没有代理可以接听电话。

# 12.1 录制菜单提示
在创建你的虚拟前台之前，你必须决定你希望提供给来电者的菜单选项，并录制公告。一个例子是："**欢迎来到XYZ。如需销售，请按1。如需支持，请按2或留在线路上找接线员**"。

>建议把用户应该按的数字放在选项之后，即 "**销售请按1**"，而不是 "请按1销售"。这是因为用户会等待所需的选项，然后 "**注册** "要按的数字是多少。
  
>关于提示文件格式，请参考:PortSIP PBX提示文件要求的文件格式是什么?
  
# 12.2 创建一个虚拟前台
你可以创建多个虚拟前台，并将其与某条线路联系起来。
  
要创建一个虚拟前台。
   
1. 在Web Portal的菜单中，点击 "高级服务 > 虚拟前台"，然后双击 "添加 "按钮。
2. 指定虚拟前台的名称和分机号码。
3. 默认情况下，PBX 使用系统预设的音频文件进行提示。点击 "**选择文件** "按钮，选择之前录制的提示菜单的文件。此外，用户还可以在 "**虚拟前台语言** "中选择虚拟前台的提示语言。
4. 呼叫转移时的提示 - 当呼叫者按下DTMF后，呼叫转移时将播放该提示文件。
5. 虚拟前台语言 - 提示文件的语言
6. 菜单选项。点击 "**添加** "按钮，指定动作和每个数字键的分机号码或系统分机号码。如果动作是指向一个特定的分机、铃声组、呼叫队列或另一个虚拟前台，也请选择你所需要的目标分机号码
7. 用户输入：该选项允许您决定虚拟前台何时开始搜索符合用户输入的分机。可用的选项详见下文。
+ 分机匹配时。虚拟前台将等待，直到呼叫者的数字序列与现有账户相匹配。一旦虚拟服务员找到一个匹配，它将呼叫该分机。当使用不同长度的账户时，这种机制很有用；但是，对于输入不存在的号码的呼叫者来说，可能会很烦人，因为虚拟前台不会开始搜索。
+ DTMF数字之间的间隙时间（秒）。虚拟前台将等待，直到以秒为单位的时间过去，然后再搜索匹配的账户。如果账户不存在，系统将播放公告，表明该分机不存在。
8. 超时允许你指定系统应等待输入多长时间。如果它没有收到任何输入，它将自动执行这个动作。这是为那些不理解菜单或没有DTMF功能的电话的来电者准备的。准备好后，点击 "**确定**"，保存虚拟前台。
9. 如果分机用户输入的DTMF值或键没有在步骤4中定义，则动作失败。用户可以在 "**呼叫失败** "部分定义在这种情况下应该如何处理呼叫，以及分机号码（如果需要）。
  
# 12.3 直接目的地
直接目的地功能有点像IVR系统的内置版本。
  
为了将呼入电话引向指定的分机，你可以使用预先配置的目的地字段，并将它们与预先录制的公告和用户输入的选项联系起来。
  
使用如下所示的示例，虚拟前台的欢迎信息将如下。"**关于销售，请按1。技术支持，请按2。对于会计，请按3。对于所有其他咨询，请按0**"。(用户输入选项与分机8000、8001、8002和8003相连）
![image](https://user-images.githubusercontent.com/112454775/218404948-1ecd2641-ee6b-4b01-a866-a5726a789925.png)
  
当配置直接的、不复杂的虚拟前台时，直接目的地是一个很好的解决方案。然而，当配置需要高级IVR开发和功能的虚拟前台时，建议使用IVR节点。

一旦建立了直接目的地链接，只要呼叫者输入与之相关的号码，系统就会呼叫目的地号码。在上面显示的样本中，当呼叫者按下2时，呼叫将被连接到分机8001。

通过在直接目的地后面放置一个英镑符号（例如，"2#"），系统将在拨打直接目的地之前等待3秒。如果你的分机号码在100范围内（101，102等），这很有用。3秒的延迟保证了来电者的完整输入（如101）将被处理，而不是只处理第一个数字。

+ 用户输入：这个数字可以是一个或多个数字；但是，在用户提供键盘输入后，系统会立即拨打直接目的地，所以直接目的地和分机号码之间的重叠可能是一个问题。例如，以 "1 "开头的分机将与 "1 "的直接目的地相冲突，因为系统将无法拨出分机号码。避免这种情况的最好办法是选择与直接目的地或邮箱和呼出电话前缀不重叠的分机号码。分机范围4xx到7xx符合这些条件。在这个领域也可以使用通配符。   
  + 如果情况导致难以改变分机分配（例如，已经流通的分机号码的名片），可以使用一个超时机制。通过在直接目的地后面放置一个英镑符号（如 "1#"），系统将等待3秒后再拨目的地。
  + 要把传真信息转到一个特定的目的地，可以使用直接目的地 "F"。宣布传真音的CNG音被系统识别，并被翻译成 "F "键。
    
+ 目的地：这个号码可以是一个内部号码（如分机或会议室）。

# 12.4 允许呼叫者直接拨打已知的分机
在播放虚拟前台提示时，呼叫者可以直接输入分机号码，以便立即接通分机。这使得知道对方分机的呼叫者可以避免通过接待员。这个选项在默认情况下是启用的。如果你想利用这个功能，只需在语音提示中解释一下，就可以指示你的来电者。
  
例如，"**欢迎来到XYZ公司。如果你知道你的当事人的分机号码，你可以现在输入，否则，销售按1。如需支持请按2**"。

# 12.5 根据用户的输入向WebHook发送HTTP请求
创建虚拟前台时，用户有三个标签：**虚拟前台**，**ACTION URL**和**外呼主叫ID**。在 "虚拟前台 "标签中，用户可以配置一个普通的虚拟前台，并在 "**ACTION URL** "中定义WebHook和相关动作。

ACTION URL 应用如下场景：

当用户拨打预先配置的DTMF键时，虚拟前台将发送一个HTTP请求到由URL定义的第三方服务器，并在第三方服务器的响应信息中解析出目标分机号码，将呼叫转发到目标分机。

+ **名称**：为ACTION URL输入一个用户友好的名称。这个字段是强制性的。
+ **类型**:选择触发Action URL的方法。PortSIP PBX允许通过用户输入的DTMF键或来电号码来触发它。根据他的要求，用户可以选择 "DTMF "或 "主叫号码"。一旦选择了 "DTMF"，如果输入的 DTMF 是 "虚拟前台 "选项卡中已指定的 DTMF ，PBX "虚拟前台 "中的设置失效，并按照 "ACTION URL "中的定义处理该呼叫。
+ **DTMF 匹配号码/来主叫方匹配号码**:根据 "动作类型 "中的选择，用户可以指定 "DTMF 匹配号码 "或 "主叫方匹配号码"。用户可以一次性输入一个分号分隔的号码列表，例如 "101;102;103"。输入的号码必须是唯一的，不能重复。匹配列表也可以指定一个数字范围，例如，860000-880000，它用于以下情况：有人打电话给虚拟前台并输入他的银行卡号。如果该号码落在匹配的DTMF范围内，虚拟前台将调用动作URL来返回一些值以指示下一步的行动。
一旦行动URL的一个项目被触发，一个HTTP请求将被发送到第三方服务器。用户可以在 "HTTP基本认证的凭证 "部分指定用于认证的用户名和密码（非强制性），并在POST或GET中选择发送HTTP请求的方法。字段 "连接超时 "和 "等待响应的超时 "是用来设置虚拟前台和WebHook服务器之间通信的超时值的。
+ **请求URL**：当预设的动作被触发时，要执行的WebHook URL将被输入这里。虚拟前台将向这个URL发送HTTP请求，并根据HTTP响应来处理呼叫。
+ **附加消息头**：允许在发送请求到WebHook的时候设置额外的HTTP头。例如，如果我们想添加key1:value和key2:value2头信息，请输入key1:value1&key2:value2。

# 12.6 HTTP请求信息
PortSIP定义了以下参数，以形成JSON格式的HTTP请求信息给WebHook。

+ **from**: 呼叫者的号码，即呼叫虚拟前台的呼叫者号码
+ **to**: 来电者的号码，即虚拟前台的分机号码
+ **input**:由用户输入的DTMF
+ **from_name**: 来电者的显示名称。如果没有提供值，它将是空的
+ **account_name**: 虚拟前台的名字。

假设我们创建了一个号码为888的虚拟前台，并命名为销售，其行动URL定义如下:

+ **名称**:Action1
+ **类型**:DTMF
+ **DTMF 匹配号码**:22;33
+ **HTTP方法**:GET
+ **请求地址**: http://www.appserver.com/dest.php
当分机101（显示名称Jason）呼叫888时，虚拟前台888将自动接听电话，并向呼叫者播放提示。当101分机拨打DTMF 22时，虚拟前台将以GET方式发送以下HTTP请求到：http://www.appserver.com/dest.php?from=101&to=888&input=22&from_name=Jason&account_name=Sales
如果 HTTP 方法选择了 POST，虚拟前台将通过 POST 方式发送以下 JSON 格式的 HTTP 请求。
```
{
"from" : "101",
"to" : "888",
"input": "22",
"from_name" : "Jason",
"account_name" : "Sales"
}
```
# 12.7 HTTP 响应信息
PortSIP PBX 对 Virtual Receptionist 发送的 HTTP 请求定义了如下的响应:

+ **status_code**: 200 或其他可能的状态代码，其中 200 代表请求成功，其他则是指失败。
+ **action**：包括 "call"、"hangup "和 "repeat "等值，表示虚拟前台要采取的行动。
  + call - 将电话转到 "目的地 "中定义的号码上。
  + hangup - 直接挂断电话
  + repeat - 重复提示信息
+ **destination**:目的地呼叫者号码。只有当 "**action** "的值被设置为 "**call** "时，它才有效；否则它将被忽略。
```
{
"status_code" : 200,
"action" : "call",
"destination" : "222"
}
```
一旦虚拟前台收到上述答复，它将把电话转到222分机。
